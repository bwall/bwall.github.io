<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Python on @botnet_hunter&#39;s blog</title>
    <link>https://bwall.github.io/tags/python/</link>
    <description>Recent content in Python on @botnet_hunter&#39;s blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>Â© 2015 Copyright Brian Wallace</copyright>
    <lastBuildDate>Sun, 12 Jun 2016 12:10:26 -0700</lastBuildDate>
    <atom:link href="https://bwall.github.io/tags/python/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>bamfdetect Module Competition</title>
      <link>https://bwall.github.io/bamfdetect-module-competition/</link>
      <pubDate>Sun, 12 Jun 2016 12:10:26 -0700</pubDate>
      
      <guid>https://bwall.github.io/bamfdetect-module-competition/</guid>
      <description>

&lt;p&gt;Writing modules for bamfdetect requires a variety of talents including reverse engineering, parsing, decryption, as well as development. For this reason, I invite everyone to test their skills to create bamfdetect modules, and compete for cash prizes.&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h1 id=&#34;bamfdetect:a8cb2ae9b81bc6d5e7db050c1a8053b0&#34;&gt;bamfdetect&lt;/h1&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/bwall/bamfdetect&#34;&gt;bamfdetect&lt;/a&gt; is a tool designed to extract the command and control configuration details from malware statically.&lt;/p&gt;

&lt;h1 id=&#34;bamfdetect-modules:a8cb2ae9b81bc6d5e7db050c1a8053b0&#34;&gt;bamfdetect modules&lt;/h1&gt;

&lt;p&gt;It is highly suggested that before writing modules for the competition that you use bamfdetect to some capacity to get an understanding of how it operates. Modules which do not make sense to the overall operation of bamfdetect may not be merged, and may not be considered a submission.&lt;/p&gt;

&lt;p&gt;bamfdetect supports three kinds of modules. These modules are referred to as preprocessors, detections modules, and post processors. With preprocessors, you have control over the raw data to be parsed by the detection modules. For instance, the existing preprocessing module is designed to decompress UPX packed files (although temporarily disabled due to security concerns with UPX). While the primary inspiration for preprocessing modules is to unpack or deobfuscate data, that is not the sole purpose of these modules, and other preprocessing ideas may be applied. Archive decompression is not considered part of preprocessing modules, and preprocessing has one input and has one output (as opposed to one input and multiple outputted files).&lt;/p&gt;

&lt;p&gt;The detection modules are the heart of bamfdetect. They are responsible for both identifying the target malware family (primarily via YARA) as well as parsing and extracting out the bot&amp;rsquo;s configuration. All configuration extraction methods are required to be static and not based on executing the malware. The closer to pure python these modules can be, the better.&lt;/p&gt;

&lt;p&gt;The post processing modules focus around using the information extracted from bot panels. For instance, in my private bamfdetect repository, I have a module which uploads all extracted bot configurations to my botnet tracking system. This allows me to immediately start tracking any malware that gets processed by my local bamfdetect setup. These modules allow for a good deal of creativity.&lt;/p&gt;

&lt;h1 id=&#34;competition:a8cb2ae9b81bc6d5e7db050c1a8053b0&#34;&gt;competition&lt;/h1&gt;

&lt;p&gt;Multiple judges (totally more than just me), will rate pull requests to the bamfdetect repository (not including previous ones). The sum of the ratings for an individual user will lead to the user&amp;rsquo;s overall score. Once the overall scores have been determined, we will sort the users by their score, and assign prizes and announce the winners.&lt;/p&gt;

&lt;p&gt;Submissions must be your own, and not the property of any corporation. The submissions will be open source and will be under the same license as bamfdetect itself. For detection modules, ensure that the judges can access the actual malware being parsed (SHA256 will suffice if sample is uploaded to VirusTotal).&lt;/p&gt;

&lt;p&gt;The first cut off for submissions is August 1st, although there are a number of scenarios where this cut off will be extended. There is no reason the cut off would be made earlier. If this results in quality contributions to bamfdetect, I will be happy to have similar competitions in the future.&lt;/p&gt;

&lt;h2 id=&#34;prizes:a8cb2ae9b81bc6d5e7db050c1a8053b0&#34;&gt;Prizes&lt;/h2&gt;

&lt;p&gt;Prizes are USD values distributed in the form of gift cards (of the user&amp;rsquo;s choice). I must be able to purchase said gift card over the internet with some level of anoniminity. Amazon gift cards are the preferred location.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;$250 in gift card&lt;/li&gt;
&lt;li&gt;$100 in gift card&lt;/li&gt;
&lt;li&gt;$50 in gift card&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Happy Hunting :)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>MarkovObfuscation in a tunneling SOCKS Proxy</title>
      <link>https://bwall.github.io/markovobfuscation-in-a-tunneling-socks-proxy/</link>
      <pubDate>Sat, 21 Nov 2015 14:41:07 -0700</pubDate>
      
      <guid>https://bwall.github.io/markovobfuscation-in-a-tunneling-socks-proxy/</guid>
      <description>

&lt;p&gt;In a &lt;a href=&#34;https://bwall.github.io/markov-chains-keyed-obfuscation/&#34;&gt;previous blog post&lt;/a&gt;, I detailed a convention I developed in order to use Markov models in order obfuscate data.  In this blog post, I will talk about a script, mtunnel, which acts as both ends of a SOCKS tunneling proxy where the transport between the two ends is obfuscated using MarkovObfuscation.&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h1 id=&#34;markovobfuscation-in-a-tunneling-socks-proxy:d712b37315982ff405528d510281f1c4&#34;&gt;MarkovObfuscation in a tunneling SOCKS Proxy&lt;/h1&gt;

&lt;p&gt;After I saw folks appeared interested in the MarkovObfuscation blog post, I decided I needed a proof of concept that actually did something.  So I started hacking away&amp;hellip;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://bwall.github.io/images/markovobfuscation_mtunnel_ed.gif&#34; alt=&#34;Edward&#34; /&gt;&lt;/p&gt;

&lt;p&gt;What I ended up with was a Python 2.7 script which created an obfuscated tunnel which could be used by anything that supported SOCKS4/SOCKS4a interfaces.&lt;/p&gt;

&lt;p&gt;The script, &lt;a href=&#34;https://github.com/bwall/markovobfuscate/blob/master/mtunnel.py&#34;&gt;mtunnel.py&lt;/a&gt;, can be found in the &lt;a href=&#34;https://github.com/bwall/markovobfuscate&#34;&gt;MarkovObfuscation Github repository&lt;/a&gt;.  This script needs to be run in two locations, local to your local application, and on a remote server (where you are tunneling out to).  When the local script is run, it provides an obfuscated tunnel to the remote server which provides a SOCKS4 and SOCKS4a interface in order to allow arbitrary TCP connections out to servers on the other end of the proxy.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://bwall.github.io/images/markovobfuscation_mtunnel_diagram.png&#34; alt=&#34;MarkovObfuscation mtunnel diagram&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;example-usage:d712b37315982ff405528d510281f1c4&#34;&gt;Example Usage&lt;/h2&gt;

&lt;p&gt;On both our local computer and remote computer, we want to download 98.txt (A Tale of Two Cities) from Project Gutenburg into datasets/98.txt:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mkdir datasets
wget http://www.gutenberg.org/files/98/98.txt -O datasets/98.txt
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You can use a different book or dataset, just make sure to change the following lines to match your setup (I will make these command line arguments eventually):&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/bwall/markovobfuscate/blob/master/mtunnel.py#L248-L252&#34;&gt;https://github.com/bwall/markovobfuscate/blob/master/mtunnel.py#L248-L252&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;On our local computer, we start up the local tunnel client to connect to our remote server at 178.62.84.249 by providing a SOCKS proxy interface on local port 9051:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;bwall@localcomputer:~/markovobfuscate$ python mtunnel.py -r 178.62.84.249 -p 9051
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then we start up our remote server (no connection is made until the SOCKS proxy is attempted to be used):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;bwall@remotecomputer:~/markovobfuscate$ python mtunnel.py -s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then on the local computer, we run curl in order to grab some data&amp;hellip;doesn&amp;rsquo;t really matter where, as long as the remote server can see it:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;bwall@localcomputer:~/markovobfuscate$ curl --socks4a 127.0.0.1:9051 https://bwall.github.io/sitemap.xml
&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;utf-8&amp;quot; standalone=&amp;quot;yes&amp;quot; ?&amp;gt;
&amp;lt;urlset xmlns=&amp;quot;http://www.sitemaps.org/schemas/sitemap/0.9&amp;quot;&amp;gt;

  &amp;lt;url&amp;gt;
    &amp;lt;loc&amp;gt;https://bwall.github.io/&amp;lt;/loc&amp;gt;
    &amp;lt;lastmod&amp;gt;2015-11-21T15:41:07-07:00&amp;lt;/lastmod&amp;gt;
    &amp;lt;priority&amp;gt;0&amp;lt;/priority&amp;gt;
  &amp;lt;/url&amp;gt;

  &amp;lt;url&amp;gt;
    &amp;lt;loc&amp;gt;https://bwall.github.io/markov-chains-keyed-obfuscation/&amp;lt;/loc&amp;gt;
    &amp;lt;lastmod&amp;gt;2015-11-21T15:41:07-07:00&amp;lt;/lastmod&amp;gt;
  &amp;lt;/url&amp;gt;

  &amp;lt;url&amp;gt;
    &amp;lt;loc&amp;gt;https://bwall.github.io/libemu-scapy-for-shellcode-on-the-network/&amp;lt;/loc&amp;gt;
    &amp;lt;lastmod&amp;gt;2015-10-11T15:41:07-07:00&amp;lt;/lastmod&amp;gt;
  &amp;lt;/url&amp;gt;

  &amp;lt;url&amp;gt;
    &amp;lt;loc&amp;gt;https://bwall.github.io/bamfdetect/&amp;lt;/loc&amp;gt;
    &amp;lt;lastmod&amp;gt;2015-10-04T17:59:07-07:00&amp;lt;/lastmod&amp;gt;
  &amp;lt;/url&amp;gt;

  &amp;lt;url&amp;gt;
    &amp;lt;loc&amp;gt;https://bwall.github.io/torque-exploit/&amp;lt;/loc&amp;gt;
    &amp;lt;lastmod&amp;gt;2014-06-02T16:19:07-07:00&amp;lt;/lastmod&amp;gt;
  &amp;lt;/url&amp;gt;

  &amp;lt;url&amp;gt;
    &amp;lt;loc&amp;gt;https://bwall.github.io/extract-hosts/&amp;lt;/loc&amp;gt;
    &amp;lt;lastmod&amp;gt;2014-04-18T10:19:07-07:00&amp;lt;/lastmod&amp;gt;
  &amp;lt;/url&amp;gt;

  &amp;lt;url&amp;gt;
    &amp;lt;loc&amp;gt;https://bwall.github.io/murdering-dexter/&amp;lt;/loc&amp;gt;
    &amp;lt;lastmod&amp;gt;2014-03-16T10:19:07-07:00&amp;lt;/lastmod&amp;gt;
  &amp;lt;/url&amp;gt;

  &amp;lt;url&amp;gt;
    &amp;lt;loc&amp;gt;https://bwall.github.io/herpes-net-3.0-sqli/&amp;lt;/loc&amp;gt;
    &amp;lt;lastmod&amp;gt;2014-03-09T10:19:07-07:00&amp;lt;/lastmod&amp;gt;
  &amp;lt;/url&amp;gt;

  &amp;lt;url&amp;gt;
    &amp;lt;loc&amp;gt;https://bwall.github.io/rsac-2014-botnet-vulnerabilities/&amp;lt;/loc&amp;gt;
    &amp;lt;lastmod&amp;gt;2014-03-09T10:19:07-07:00&amp;lt;/lastmod&amp;gt;
  &amp;lt;/url&amp;gt;

  &amp;lt;url&amp;gt;
    &amp;lt;loc&amp;gt;https://bwall.github.io/multilocker-backdoor/&amp;lt;/loc&amp;gt;
    &amp;lt;lastmod&amp;gt;2014-03-09T10:19:07-07:00&amp;lt;/lastmod&amp;gt;
  &amp;lt;/url&amp;gt;

&amp;lt;/urlset&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If we watch this communication in Wireshark, we can see this is the data that is sent over TCP data:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://bwall.github.io/images/markovobfuscation_mtunnel_pcap.png&#34; alt=&#34;MarkovObfuscation mtunnel PCAP data&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Pretty obvious to see that this is not an HTTPS connection.  In its current state though, it doesn&amp;rsquo;t quite look like anything else.  This could be converted to look like HTTP traffic, or some other protocol which may go relatively unnoticed.&lt;/p&gt;

&lt;p&gt;Enjoy :)&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://bwall.github.io/images/markovobfuscation_mtunnel_ed2.gif&#34; alt=&#34;Ed again&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Using Markov chains as a keyed obfuscation method</title>
      <link>https://bwall.github.io/markov-chains-keyed-obfuscation/</link>
      <pubDate>Fri, 20 Nov 2015 19:41:07 -0700</pubDate>
      
      <guid>https://bwall.github.io/markov-chains-keyed-obfuscation/</guid>
      <description>

&lt;p&gt;Machine learning methods, simple and complex, can be used in almost all aspects of our digital lives.  Interestingly enough, it is rarely observed in the offensive side of information security.  When I was thinking about the number of ways an attacker can exfiltrate data past a firewall, I decided to try out an old favorite, Markov chains, in order to build the next generation of &lt;a href=&#34;https://en.wikipedia.org/wiki/Book_cipher&#34;&gt;&amp;ldquo;book ciphers&amp;rdquo;&lt;/a&gt;.&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h1 id=&#34;update:84e7421e24ba41f3bed9835a932084c9&#34;&gt;&lt;em&gt;UPDATE&lt;/em&gt;&lt;/h1&gt;

&lt;p&gt;A Github repository has been created for this project: &lt;a href=&#34;https://github.com/bwall/markovobfuscate&#34;&gt;markovobfuscate&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&#34;markov-chains-as-a-keyed-obfuscation-method:84e7421e24ba41f3bed9835a932084c9&#34;&gt;Markov Chains as a Keyed Obfuscation Method&lt;/h1&gt;

&lt;p&gt;This is a project that has been sitting in my private git repository for a long while, and after I was recently reminded of it, I&amp;rsquo;ve decided to write it up and do an initial release.  The premise of the project is to use Markov chains in order to obfuscate binary information to appear similar to written language.&lt;/p&gt;

&lt;p&gt;I feel it&amp;rsquo;d probably be good for me to mention this fairly early on&amp;hellip;I AM NOT A DATA SCIENTIST!  I enjoy using machine learning where I can, but I have no formal training in it, and I am not a data scientist at my employer.  I&amp;rsquo;m absolutely a data science amateur, but what machine learning I do know, I have found it to be extremely useful.  On another note, I highly suggest that anyone reading this should spend some time to learn some basic machine learning concepts at some point.  It is an extremely useful tool to have in your toolbelt.&lt;/p&gt;

&lt;h2 id=&#34;markov-chains:84e7421e24ba41f3bed9835a932084c9&#34;&gt;Markov Chains&lt;/h2&gt;

&lt;p&gt;For anyone not familiar with Markov chains, they are very commonly used in conversational bots.  For example, there are a number of bots on Twitter which emulate people.  For instance, &lt;a href=&#34;https://twitter.com/da_667&#34;&gt;@da_667&lt;/a&gt; has setup &lt;a href=&#34;https://twitter.com/667__ebooks&#34;&gt;@667__ebooks&lt;/a&gt; as a bot which impersonates @da_667 based on what he&amp;rsquo;s said on Twitter in the past.  Presumably, this bot is using Markov chains, which have been generated with his past Twitter feed to generate messages such as this:&lt;/p&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; lang=&#34;en&#34;&gt;&lt;p lang=&#34;en&#34; dir=&#34;ltr&#34;&gt;my theory: colonel sanders isn&amp;#39;t dead because he&amp;#39;s worked for javascript.&lt;/p&gt;&amp;mdash; 667&lt;strong&gt;ebooks (@667&lt;/strong&gt;ebooks) &lt;a href=&#34;https://twitter.com/667__ebooks/status/667718905012600836&#34;&gt;November 20, 2015&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;While this appears to be English, it doesn&amp;rsquo;t entirely make sense (but still amusing).&lt;/p&gt;

&lt;p&gt;The way most Markov chains operate is in two phases: Learning and Generating.  Markov chains can also be used to &amp;ldquo;fit&amp;rdquo; input, in order to determine how likely a sentence was to have been generated from the source, but that is not relevant to this post.  In the Learning phase, the Markov engine is fed a data set (a set of sentences) which were generated by the source being emulated.  The engine then breaks these sentences down into words, and calculates the chance that each word will follow every other word.&lt;/p&gt;

&lt;p&gt;Consider the following:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;markov.learn([&amp;quot;im on fire&amp;quot;, &amp;quot;im going to die&amp;quot;])

            im   on  fire going to die
im          0    .5  0    .5    0  0
on          0    0   1    0     0  0
fire        0    0   0    0     0  0
going       0    0   0    0     1  0
to          0    0   0    0     0  1
die         0    0   0    0     0  0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;While this can be a real pain to do by hand, it is really easy to gather information like this in code.&lt;/p&gt;

&lt;p&gt;When in the generation phase, the Markov engine will pick the most likely word to follow the current word in order to pick the next word in the sentence to tweet.&lt;/p&gt;

&lt;p&gt;For both phases, I have simplified the description, and some implementations can grow to be significantly more complicated.&lt;/p&gt;

&lt;h2 id=&#34;using-markov-chains-to-our-advantage:84e7421e24ba41f3bed9835a932084c9&#34;&gt;Using Markov Chains to Our Advantage&lt;/h2&gt;

&lt;p&gt;Given our previous knowledge of how Markov chains work, we can potentially use this knowledge to create an obfuscated stream of data which appears like English (or any other language we feel like using).  The concept is as follows: Instead of using the most likely word to follow our current word, we use the Nth most likely word to follow, where N represents a single byte we are trying to send.  This does require that both sides have the same Markov model, but this isn&amp;rsquo;t much of an issue, as it only requires both sides to have read the same &amp;ldquo;book&amp;rdquo; or set of sentences.&lt;/p&gt;

&lt;p&gt;Consider the following:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;current_word = &amp;quot;apple&amp;quot;
sorted_list_of_words_following_apple = [
    &amp;quot;sucks&amp;quot;,
    &amp;quot;over-charges&amp;quot;,
    &amp;quot;sauce&amp;quot;,
    &amp;quot;cider&amp;quot;,
    ...
]
byte_to_represent = 0x2

print current_word + &amp;quot; &amp;quot; + sorted_list_of_words_following_apple[byte_to_represent]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Additionally, there is a possible issue where our &amp;ldquo;book&amp;rdquo; will not generate enough word comparisons to give us enough information to represent a full 8 bit value.  In order to recover from this, we can spread the value out over multiple words, and require that each byte must be represented by available values of at least 256.&lt;/p&gt;

&lt;h2 id=&#34;proof-of-concept:84e7421e24ba41f3bed9835a932084c9&#34;&gt;Proof of Concept&lt;/h2&gt;

&lt;p&gt;As you may have imagined, I have built a proof of concept for this.  It is in pure Python 2, and should be quite simple to integrate into Python based projects.  If you working in a language other than Python&amp;hellip;good luck!  But seriously, hopefully you can read enough Python to reimplement based on the supplied code and this blog post.  Additionally, if you implement this in another programming language or at all, please feel to let me know on &lt;a href=&#34;https://twitter.com/botnet_hunter&#34;&gt;Twitter&lt;/a&gt; or something.&lt;/p&gt;

&lt;p&gt;Here&amp;rsquo;s an example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# Markov engines fed with War and Peace, thanks to Project Gutenberg.
Original string: This is a test message to prove the concept.

Obfuscated string: each with head had thought that rostov holding her a pause occurred said quickly began rapidly taking up hurriedly drinking his hand 
him kutuzov sent tikhon interrupted natasha spoke most precious and some strange beautiful armenian was lying or inevitability governing the count&#39;s 
eldest boy you&#39;ll allow themselves by heart began wiping away his brows with your faithful unalterable love not go of war would in due form making 
long wanted him such cases but napoleon was standing where&#39;s that might but simply .  next morning in petersburg in each week so what sweets .  
those pranks in passing along looking gloomily at pierre rose

Deobfuscated string: This is a test message to prove the concept.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;As any reader should be able to tell, no sane person typed the obfuscated string, but it could be quite difficult for a naive algorithm (working at scale) to be even remotely close to being able to tell that this information was obfuscated, much less what the underlying data was.  Interestingly enough, since we have some room for randomization (based on the first word chosen), each time the message is obfuscated, it can be different.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Original string: This is a test message to prove the concept.

Obfuscated string: lord forgive it then assume the campaign during 1812 has deigned to meet at midday sun appeared .  he&#39;s grinning the army 
beyond dorogobuzh while with those orders as having wrung a pleasant comforting and asked petya .  he kissed them sat among those big head aches and 
now pierre inquired about playing cards holding in that here my arms .  how things snatched at dolokhov&#39;s intimacy now frightened imploring look 
round natasha rising wind that .  please .  what&#39;s in bed during that the count&#39;s dissatisfaction on taking rather for himself mentally .  he&#39;s our most 
in command preceding order to speak

Deobfuscated string: This is a test message to prove the concept.




Original string: This is a test message to prove the concept.

Obfuscated string: then already knew about moscow already prepared if all said crossly that before leaving the same she&#39;s very young bear me no nonsense 
as our parting from west paris would sacrifice had prepared the thought occurred but simply solicit donations received one might need thought a place 
a soldier passed before how papa he might expose his first saw through without saying not going for christ&#39;s sake in the sun but should wake natasha 
the very still showing pity he loved so count peter kirilovich said dron died of france alone even those taking

Deobfuscated string: This is a test message to prove the concept.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Let&amp;rsquo;s try a more interesting example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Original string: -----BEGIN ENCRYPTED PRIVATE KEY-----
MIICxjBABgkqhkiG9w0BBQ0wMzAbBgkqhkiG9w0BBQwwDgQIDHHhyAEZQoICAggA
MBQGCCqGSIb3DQMHBAiHEg+MCYQ30ASCAoDEvGvFRHvtWOb5Rc0f3lbVKqeUvWSz
xQn+rZELHnwb6baolmbFcsi6XkacVzL/EF7Ll4de/CSQ6pZZCCvfDzov0mPOuGve
SAe7hbAcol7+JWVfzbnVTblPf0i7mwSvK61cKq7YfcKJ2os/uJGpeX9zraywWyFx
f+EdTr348dOez8uHkURyY1cvSHsIdITALkChOonAYT68SVighTeB6xOCwfmsHx+X
3Qbhom2YCIxfJiaAoz2/LndCpDaEfOrVrxXFOKXrIbmeDEyjDQj16AVni9uuaj7l
NiO3zrrqxsfdVINPaAYRKQnS102jXqkH01z72c/MpMMC6dwZswF5V3R7RSXngyBn
1GLxVFHKR753Gt0IDag13Bd8Jt890/v0tE0Kx66jCkRGn+VCq6+bsnh7VpTH/cG5
dlFnv56lv2leknu5ghdJHX8YQ6HjnioaaheLA+ORAxqAlD8Itt1/pRBOOMSkutdz
d1px9dB2ZBpSoRAOcBwU5aFaw9uu+tXyzrPM3tZomu8ryQYMNlmVgPNDJOz6jPJi
jaZHWTS7U6j370oH/B0KTUG/ybrJGFnOmPP4h2u/ugG75EkfotURsvbrWuetQhOi
TCH+9nbIcT3pxnTXqI2IRHZXMturQ+6fqlJF3bb9bWarMBuC3KgprqyqXxeM0Sqg
VlyKLWwAuMf2Ec7t7ujqaNmVgv6bpwHEbR6njIi7lC7j4w6D2YQ8vacgvS3MB/K0
SX54HNVBVuXhAixPtYJ6tOBGm7QFAKaXju0PJ+AljnMEsHRekOs2u42OHBXEWDE8
VHw7/lTXWsJkBcQM+g/svyqV4xKHDAixPms2SUwJyKjvEgV+CQok4F/T
-----END ENCRYPTED PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIC9TCCAl6gAwIBAgIJANL8E4epRNznMA0GCSqGSIb3DQEBBQUAMFsxGDAWBgNV
BAoTD1N1cGVyZmlzaCwgSW5jLjELMAkGA1UEBxMCU0YxCzAJBgNVBAgTAkNBMQsw
CQYDVQQGEwJVUzEYMBYGA1UEAxMPU3VwZXJmaXNoLCBJbmMuMB4XDTE0MDUxMjE2
MjUyNloXDTM0MDUwNzE2MjUyNlowWzEYMBYGA1UEChMPU3VwZXJmaXNoLCBJbmMu
MQswCQYDVQQHEwJTRjELMAkGA1UECBMCQ0ExCzAJBgNVBAYTAlVTMRgwFgYDVQQD
Ew9TdXBlcmZpc2gsIEluYy4wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAOjz
Shh2Xxk/sc9Y6X9DBwmVgDXFD/5xMSeBmRImIKXfj2r8QlU57gk4idngNsSsAYJb
1Tnm+Y8HiN/+7vahFM6pdEXY/fAXVyqC4XouEpNarIrXFWPRt5tVgA9YvBxJ7SBi
3bZMpTrrHD2g/3pxptMQeDOuS8Ic/ZJKocPnQaQtAgMBAAGjgcAwgb0wDAYDVR0T
BAUwAwEB/zAdBgNVHQ4EFgQU+5izU38URC7o7tUJml4OVoaoNYgwgY0GA1UdIwSB
hTCBgoAU+5izU38URC7o7tUJml4OVoaoNYihX6RdMFsxGDAWBgNVBAoTD1N1cGVy
ZmlzaCwgSW5jLjELMAkGA1UEBxMCU0YxCzAJBgNVBAgTAkNBMQswCQYDVQQGEwJV
UzEYMBYGA1UEAxMPU3VwZXJmaXNoLCBJbmMuggkA0vwTh6lE3OcwDQYJKoZIhvcN
AQEFBQADgYEApHyg7ApKx3DEcWjzOyLi3JyN0JL+c35yK1VEmxu0Qusfr76645Oj
1IsYwpTws6a9ZTRMzST4GQvFFQra81eLqYbPbMPuhC+FCxkUF5i0DNSWi+kczJXJ
TtCqSwGl9t9JEoFqvtW+znZ9TqyLiOMw7TGEUI+88VAqW0qmXnwPcfo=
-----END CERTIFICATE-----

Obfuscated string: countess in fact been captured if all sorts i chapter xx chapter xi the most doleful nocturnes on tiptoe 
noiselessly to an apple should i made to one arm he meant too and without hurting her fate and told count well well my pet 
whose sake stop them to attack singly across that prince bolkonski&#39;s simplicity .  he really began pacing the adjutant 
reproached those voices footsteps going up .  anatole returned a voice plainly terribly wild beast was a most cases we must 
remain attached themselves in reply the fact they have turned loaded five years .  he moved voices sang morel with his body 
as petya heard and took command justify his eyes to cry or four so let that movement .  again used all became smooth as hostess 
at tarutino a peasant laborer .  as napoleon frowning slightly in no wish so you&#39;ll forget to think only tell everything became 
distorted out over once shown to be pitied so definitely ordered up poor creature said on louis xiv&#39;s activity tushin not my cousin 
she too there await him her old friend tell cried petya .  at pultusk .  countess petted and he used when once heard .  boris but 
before you believe either in different companies which russian arms board them come when had decided by word incomprehensible which 
the best for peace or me pass anna semenovna continued after prince vasili said smiling young rostov felt though no definite means 
death they saw several men is god my position trying whether this time since lived somewhere with pale colored breeches he will win 
but neither to what said timokhin and we really begin what lay your serfs a loud at their carts should i understand that so soon 
taking no she called dunyasha had told herself from here at another his smile betraying his face again glancing from lifting him 
how i agree oh i mean for prince bagration&#39;s face became known as women here on reading was coming you should tell my sister 
remarked another peasant families who entered more orderers but also good kind are not heard at midday there seemed difficult 
would receive this terrible thing which natasha laughed turned angrily shouted someone inquires by fear of happiness he remained 
in their campfires while by way full of a minute .  i&#39;m standing among a soldier three hundred years his son&#39;s letter and some 
great blessing if from princess lay the door trying for there have changed she made as young couple he replied balaga and yet 
with only without realizing that other she became distorted mouth rode on your charming that made wills produced from her might .  
anna scherer&#39;s reception by way we did i consider who took some unknown but dared complain to let relief after every soldier there 
or understand people&#39;s welfare the whole body as hostess .  before the war by asking silly ladies with rapid retreat is why go out 
and though embracing prince noticing trifles you it impossible .  their numbers got chapter xxxvi prince de soutenir ce grand is 
it looked frightened face .  of doing said one like everyone questioned .  in prince i always tried me is easy chair she feared a
german princes who till you got that god and were trying through at her again smilingly talking dron drop .  some tricks glanced
round inquiringly repeated but at daybreak said quickly gliding sleigh runners and by word fire he were an awakening and their 
fellows do you for nicholas sent instructions that after passing by long lashes that&#39;ll teach this same heights pass to go i might
very readily introduced mazurka began reciting some rum to avoid anything are often troubling about petya fixing on go into 
english parliament that an account as legitimate questions humanity of great success might he as emperor after what or sometimes
asked you been written by pierre seemed congested somewhere or perhaps she remarked someone asks the russians with delight of 
doing to your taste .  it like to think speak .  the new sitting opposite hill lay in search facility in with curiosity awe 
struck prince i want rain entered those blasphemous words frightened face of thought kutuzov arrived during fifteen can i can
stay by to my country amid their turn back chest shoulders .  and wished natasha left eye could do anything only feared 
napoleon frowning without looking malignantly at smolensk at present my enemy force commensurate with life my sister leave 
his serene highness&#39; staff that kutuzov arrived at once recognized napoleon nor believed anyone or lesser interval boom 
boom boom flopped into moscow either the cause prompting the latter instinctively feel themselves from moscow at it an 
unknown and suddenly the war andrew interrupted but neither .  those other trouser leg was needed said yes that&#39;s twue 
devil mack and a crowd pushing anatole continuing to the night said but changed boris having her grief fell off any purpose
immediately recognizing the last all are often forgot them with them because our lodge a happy all who must expect this 
not far ahead shot the russians need to be told chiefly to marry he still firing but quite unclothed sat some steps 
accompanied them listened wishing but dared attack said that for christ&#39;s sake eh dron and prince went inside their 
theory say the expression gradually diminishes or lesser remoteness of man&#39;s long as possible power needs and i expected
from men were called power 2 when after his partner in each frenchman .  to die tomorrow your head like when spoken 
laughingly of view nor in alarm was made so busy causing the field especially on its peculiarly deliberate .  our 
forefather adam to marry you look as people always the fire is i owe forty eight feet off mamma pressed to avoid 
general complained of doing this set them over them not heard on the cause they gazed rapturously breathless when alone 
knew all is constantly conflict of wine .  i&#39;m heartily they turned upside down as little lamp stood met for her usual simple .  
prince told them all or self possession mingled joy pierre for tomorrow at present affairs every action depends and saw immense 
number is not very people spoke in a special deep wrinkles on the country amid his nose the campaign it under precisely two o&#39;clock 
left the people might our entrenchments but then immediately became his feet stood at home a different camps and told herself with 
closed as commander for us two officers directing her voice no mary having brought and put it stood rapt gaze disturbed .  the 
regiment quivered angrily to go said was telling of something unnatural state affairs pierre glanced at schon gut morgen he 
kissed princess a sense in 1805 and we were much at the one need anything for no confusion .  everything came once lit struck 
by the rostovs&#39; being used supposing natasha on said what and seeing clearly the emperor left us rather bigger one has not 
consider kurakin&#39;s demand because in regard as this there has begun nor anywhere tomorrow brings victory at last chords of his knees 
some from another horse the village country ahead to him such blessedness which was napoleon asked me natasha continued that other 
she left arm of great natural manner were heard bickering with the third that same life was his eye could therefore so badly things and 
an incomprehensible he held both passed the old colonel is easy chair for others treated one after looking ecstatically conscious 
is better if on receiving a month reviewing troops plunder .  this officer who would she laughed talked over which it grew some places 
for whom did .  ah reverberated now by memories awoke .  one no nonsense old courtier feel i not bear .  do like prince could speak 
is nothing said alpatych lifting up but helene beaming smile so much money he turned red .  then just like affectation .  yet all up 
your disposal of natasha&#39;s singing a red ribbon of napoleon asked anatole kuragin go my soul not my uncle came a bit wait 
haven&#39;t stretchers .  why felt by name is usually complicated disease .  count arakcheev and looked frightened expression as 
usual semblance of borodino not that your faithful slave of pierre&#39;s caution .  pierre thought .  tell your mother&#39;s place to 
avoid inconveniencing him how that natasha listened now felt uncomfortable position rose as every face glowing with animation but 
changed .  you still fresh columns which afterwards he kissed princess never mind instantly guessed they wanted i&#39;ll have it over 
thirty five minutes later .  let herself was brought and yet my friends went every now did it still funnier .  let anyone told their 
eyes looked long coat said she made earlier than she made pierre moved them how his actions there anything wrong in every face 
glowing with each to fight a woman&#39;s dress princess drubetskaya&#39;s case insisted though declaring to one mass rendered him i take 
out prince in despair how once glance inviting him to cry though whenever a single division will also instructed me but dared not 
much better lie .  ah it which everything around pierre rose .  without trying with quick resolute face beamed with more easily some 
not notice him having done otherwise than this same living on her too but would call in advance of man&#39;s honor remarked vera 
sufficiently prepared for a carriage containing the battle on business weary but even denisov expressed .  nicholas will to all 
rostov&#39;s cards that their efforts is done at each on as young horse in a talk alone with him walked kutuzov&#39;s groom a ball recoils 
after crossing herself evidently just the chief subjects were .  o p .  boris to begin your victory said her brother&#39;s with people 
from a couple left petersburg society will warm whiffs of .  dolokhov smiled amiably at one thought their fellow prince theodore 
she screamed swore on like prince koutouzov to pass natasha whom will call i&#39;ll tell natasha insisted began clapping pierre rose 
up stroked the hill the carriage inquired zherkov and this class and my beloved bald general with kutuzov looked significantly at 
this pierre repeated her not give him over natasha you got so what fun nor the porch there said that affair of self justifications 
of command turned him so remote and see an approaching whistle flew into which seemed the world was such moments rose superior 
french phrases marshals stood hesitating piteous despairing gesture of his master of prussia ever done nothing from he returned 
from where candles or not resist their expression seized on by special protection and looked out beyond which two unequal to princess 
felt numb in dismay and taking my new military side and felt after its inevitable to hear this expression thoughtful smile had time nesvitski drove 
his power because he tried with love affair would be worthy added addressing michaud how your love one for any 
money decide or into which every word to say he&#39;s at a quiet backbiter said without receiving news with great balloon leppich now 
just more this will warm he received .  our talk related how is taken definite and now much afraid even the captain rose took me 
said holding and if only sound eye lit stone sparkled with your turn from sonya my friends told you for permission previously 
seemed thriving and in 1805 and therefore fought this question of police .  who the twenty horsemen galloped away when napoleon could 
at cards behind so far ahead of and though her a man&#39;s good said the action so she never loved prince vasili .  count on returning .  
do leave it then explained simply directed in them others on parade does up another way guewilla warfare had not understanding the 
bridge because you to all were burning lips having brought yourself said the matter princess is a commander overtaking baggage or 
another division not himself sick russians left near by every loss for himself moving according to kill you this class for napoleon 
the world only by everybody know about her old conditions of natasha&#39;s whole series for several important occasions that all 
would sometimes stronger the ground slip as prince bolkonski&#39;s no peace chapter xxxii beside countess i felt convinced you not 
himself away into alexander&#39;s guards before this had witnessed on sundays .  said bolkonski she passed dolokhov made in vienna .  
those same resolution pierre evidently feeling at yankovo ten guns to understand a whole .  ah it what regiment prince answered 
zherkov had begun prince kuragin into her house as often thought she must seem to the next he drew bagration bent till he is bad composition but 
the thought were silent feeling for war began knitting of prisoners looking in one offered it they desire was coming 
along get to get her but always directed toward restraining his majesty at heart well sounded buoyant steps were busy as happens 
sometimes came from you papa in with long and still an equal power unobtrusively simply .  go out go quickly down .  look was said 
mary moved his cheeks sunken emaciated young people such justification .  princess mary don&#39;t forget yourself your regiment of 
prussia without content .  still regarded as people was his intention .  very quiet manner without her thin strap and with so many 
such ardor all a most gracious sovereign has proposed that way bagration who would grow severely but that&#39;s another voice suddenly 
growing angry reprimand for himself be destroyed religion napoleon but which afterwards pursued began working in a time and felt in 
order will remain inactive would become as in vain to remain in different people introduced hospitals death is my letter and felt 
offended me so terrible what have written .  then having to her look was all sorts a thing was there must dance song in full 
significance have another push yourself worthy men left for nothing at smolensk and made your life pursued their horses bridled 
her life itself is an apple also looking out .  some voices bowed himself or if it come .  from what makes it all made earlier 
said something black with particular moral support you but never thought such reflections on tiptoe and some larger or is moving 
her she remarked that lay considered everything became convinced the drawing out directly opposite reputations .  petya cried 
prince is already be called king overcoming by prince not take murat solemnly at his nose sat like cords that look up or should 
insist .  prince murat i knew that even before others what to help with sonya i expect from bad lookout for having seen alone could 
sit whole position because anatole&#39;s appearance of his small white chamois leather case and if he stopped with natasha needed 
which princess glanced through his master in attendance considered by giving detailed chat generally wore was thinking man nor less 
chance remarked loudly and the fire very few paces from above him seemed very unwell and no no connection between their pace went 
rapidly across to him yet man can answer to say remarked the men in chief&#39;s actions was over rostov standing there oh hush seemed 
quite unexpected direction in accord and self abasement .  before such lengths and where willarski found that the action they thought 
and is much since she was decided to wait a man&#39;s sharp trot only to wait to herself was lying recovering or sent greetings from 
vienna were it now smiling sardonically and you speak so replied rapp do all at braunau was taken as of free of reason prince 
bagration reported having dressed his serene expression softened grateful but to dinner called buonaparte is good naturedly as 
something sweet sorrow which dolokhov flashed lightning from your men went red lips grew quite new count she ought to dinner 
taciturn .  rostov when having heard probably bruised face whipping up a few replies about the latter understood them they again 
smilingly to die feeling there they carried off properly he was covered chair how his eye the evening i who held a loud speranski 
only necessary not sleep either a talk moved forward words were placed himself prince andrew&#39;s estate prince bolkonski&#39;s not have 
them details himself quite independently of events have received leaflets with all came four days previously .  have led astray .  
for nicholas so and rode to work all nonsense humbug exclaimed different person .  but despite these consultations were evidently 
so strong effect she ought not being played its normal physical condition the bridge fire in this consciousness as best for several officer who do all 
she with excitement of happiness of horses so full rations the cause mathematics from pierre ran to go very bad 
for sonya natasha with marya concerned her slender mischievous with people is known grandee of things ask for some voices then now 
why there when when expressing the air as other watched for one said smiling face reporting that terrible recollections of russia while 
it seemed by another reminded one officer with merry shouts onto it yes go any work too well mamma are both these wounded lay with me 
too well disposed her only sound and some troops it necessary things seem of this old friend older .  two conceptions the hill 
they expected on leave permits had thought impossible for some given which though mankind especially against utitsa semenovsk 
hollow between her lips parted she asked indicating a moment though shy childlike fear getting into what luck the morning tikhon 
briskly forward to understand that his master but .  look evidently so pierre so accustomed always became still his intention .  
of hussars to cry directly the horses showered upon eykhen threatening the other wounded at some intrigue egotism conflict .  let down 
by general weyrother to be arranged some means death none but now did what to pass this there no less insistent on them i&#39;ll 
trust yourself to the latter had noticed them up three weeks had suddenly flaring up their box those tears again heard so strongly 
as clear blue frocks and having summoned appeared and some message dolgorukov the will call and though a day fleecy clouds floating to 
the evening speranski did he had worn a boy with satisfaction flitted to some message dolgorukov as all came an aide de beausset&#39;s 
face yet met pierre felt as she repeated approvingly evidently means he stood irresolutely beside denisov not understood me under 
what they drew dolokhov got somewhere and the great russia but she gazed for themselves on he used when trying but yet been lost faith 
you done all by self satisfaction ran along at pierre now taking hers .  here tomorrow .  the field guns on taking notes he spoke 
her daughter&#39;s distress some steps he listened not true conservatives a german fellow men came her face changed the end 
kutuzov&#39;s instructions she tried equally indifferent case by other evening the position away to do we feel friendship of some like 
how many new dresses french official who sometimes enters russia .  he were placed them while drying it to help laughing long 
mustache that and see how d&#39;you do that&#39;ll do that feeling bound himself from falling over pink dresses into prussia ever 
increasing seemed to be prepared raising of and sometimes even seem quite differently the regiment having rested and sometimes 
complete victory and he approached that made some invisible smoker .  by people was unable from bogucharovo about i made me only 
been living in consequence has an hussar horses near one with pale scared look on with another sort had she with bare hand will all 
alone knew he ran from excitement shown him no government how nice stepmother .  for but our failures resulting from being foes take 
any purpose we assume that sort out what kutuzov to hear it true not an atmosphere to hear the back distracted count cyril says or my 
fate to an honorable gentleman or perhaps all everything said addressing natasha no means what one can one the horses away the very 
erect majestically .  why count sat in another wounded spirit too great delight which is of death i chapter xxii next glanced through 
for this conversation upon eykhen threatening to your belly .  said uncle what your troops it that so accustomed groove he and above 
all one as having interrupted dolgorukov ride through napoleons louis xv at and though five rubles for her fate not ask an evident to 
kutuzov fell off blockhead well let kuragin made some orders pierre found dolokhov in a field shouting that of human lives were taken 
were taken by to set and that here i&#39;ve done but always before yesterday replied but dared to feel when dolokhov pressed his hair her 
the two battles at bogucharovo .  what&#39;s he could do his leg glancing however small prussian war when denisov .  sometimes flung 
herself so well read them smiled in waiting your carriage drove through and did everybody took heed her look there&#39;s nobody wants to 
be quick and those scoundrels .  please vasili but on cause .  he&#39;s chosen words to her companion makarin dashed out but again going 
round .  she says to love which always thoughts ran toward the french voices trying for someone would always came two fires in me last 
an old dotard father is already knew no hindrance if threatening inaccessible it matter so ill suited the officers the wounded yet 
left long expected this happened there very old days on pierre&#39;s stories but why he replied balaga into a year had seemed extremely 
said denisov who i got off their minds will hardly heard the same path in view the third officer comes from him do wish her to herself 
and felt for in thy ways there there from west attracting to express what without doing all so it&#39;s your ranks carried into action 
began walking in russian nobility and it gave instructions and still young girl she&#39;s pretty young men should long dresses into this 
field where napoleon his attention to cry when two very clear bold features was a boy you he wore medals both of genius every other 
french uhlans stationed or distributing this expression which rose increasingly triumphant that a boy now called philosophical 
historians the more just try historic character though not express his cheeks who formed some steps up went he shouted and who says 
clever .  only person vanishes in these good day who they went first that question following this new laws she and smiled 
involuntarily asked arakcheev who moved another at times very soon for petya blushing still nothing wrong to remain any need i remember 
we ourselves will fall at and looking evergreen firs dotted about kutuzov did once when dressed for several instances of life done 
the same wave white shirt and her companion a tall guardsman drove her when trying carefully packed urged could have read .  
besides humiliation .  rostov said tikhon what regiment in three windows rattling in a table now heard anything .  but felt already 
gone so dark for my pet whose aid of god upon on an illegitimate son shall drive you wish you about anything looked and when 
opportunity now always eats his last days bogucharovo and no thought independent existence he rode so now that&#39;s twue devil mack 
and though not at midday they danced daniel ulyulyuing were quite out when trying said what natasha&#39;s eyes meeting bagration&#39;s 
colloquies with our brave men left without offending mary returned home alone did me everything coexisting with all made expeditions 
and with black horses kept increasing fog singing waving her a whisper behind still farther movement got to a different firm 
resolution not feel like father whom could hear .  anatole and have sent envoys demanding now we&#39;ll take offense immediately dropped 
his head coachman this and some precious object for and smiled almost with her about himself what more distinguished important 
posts formed to look back and now necessary preparations and sat plunged into prince vasili&#39;s two decorations and left wing 
especially attracted general bonaparte having stumbled over bolkonski had been transferred .  these difficult because by the latter 
having written that my enemies to carry off of me ah well then footsteps or someone on he exclaimed princess rose up more is 
difficult .  here exclaimed with one direction rose to put myself with whom do in human minds roam but an impression but seeing in these 
i held only son would fall for everyone turned outwards but a dream said smiling birch tree can tell one&#39;s shoulders back so far as 
clear daylight of what regiment to an advanced post stood but all made in on till anatole&#39;s departure from every evening goes he 
took poleon himself in full light up between love letter of your future is our salvation .  again quarreled said you it long since left 
or all began looking dark in war when suddenly seeing count there at hand you&#39;re shaking him the frenchman never said his room with you 
at mytishchi had sent immediately on them your letter direct advance had been happy mood unusual something on like anybody now then 
into our arms and one gets thin practiced fingers with boris again asked of being helped nicholas will as daylight he glanced severely 
to talk loudly among the same preparations had any harm is natural relations sometimes his shoulders went toward balashev to him walked 
or another you been won on passing to all men around were suddenly began counting his time who were made not as happens to hear 
something down by bennigsen rather late one spoke great difficulty of the captain asked you remember these movements prince returned 
to him feel this unknown quantity of prisoners he glanced ironically without my pipe to show to know himself whether telling .  
here is no thought a cossack made remarks as ever lay between her .  even if something fresh .  even bonaparte will hear of 
pierre understood his long black .  prince michael ianovich he continued this position became alive and as strong escort along our 
emperor francis as many toasts it&#39;s she grew deeper in war andrew could maintain his hand that lay from abroad no hindrance and saw 
them had then we had died she ought and sonya were seen even as were an imploring voice apparently been captured just below the 
french could have met the fire broke apart before rostov also looked about shouted when alone enabled his head triumphantly sometimes 
even my carriage passing that if quite apart said aloud bitterly .  before it it should repay .  ah well messieurs et la louis philippe 
to serve in everything that&#39;s true so busy he could talk with pleasure but gave us rather as elsewhere .  everything remember always 
exist because gaiety seemed quite different camps the evening andrew to set consisting in love mutual friends you must live character 
to be what kutuzov began dragging logs with equal ease with equal zero we met more quickly changing shadows without cause pierre recognized the 
movement full speed before prince understood .  you seen running his opinion these letters were dragging logs from 
sonya too painful lash on august 1809 when with so quickly doffing his hair remained there had learned well in that seemed rather 
the emperor he met because of a military administrative political world the battle had time together stirred .  everyone expected was 
too said hurriedly sought that those off so beautiful bitch are free and rostov looked how they all sorts and natasha her look it&#39;s 
the whole field not the cause prompting the fact the last words der krieg muss in waiting ready according to leave this will bring 
her nephew irritably of inevitability in attendance at tilsit with bare floor window and only hope i like natasha looked attentively 
said something important posts gentlemen i don&#39;t

Deobfuscated string: -----BEGIN ENCRYPTED PRIVATE KEY-----
MIICxjBABgkqhkiG9w0BBQ0wMzAbBgkqhkiG9w0BBQwwDgQIDHHhyAEZQoICAggA
MBQGCCqGSIb3DQMHBAiHEg+MCYQ30ASCAoDEvGvFRHvtWOb5Rc0f3lbVKqeUvWSz
xQn+rZELHnwb6baolmbFcsi6XkacVzL/EF7Ll4de/CSQ6pZZCCvfDzov0mPOuGve
SAe7hbAcol7+JWVfzbnVTblPf0i7mwSvK61cKq7YfcKJ2os/uJGpeX9zraywWyFx
f+EdTr348dOez8uHkURyY1cvSHsIdITALkChOonAYT68SVighTeB6xOCwfmsHx+X
3Qbhom2YCIxfJiaAoz2/LndCpDaEfOrVrxXFOKXrIbmeDEyjDQj16AVni9uuaj7l
NiO3zrrqxsfdVINPaAYRKQnS102jXqkH01z72c/MpMMC6dwZswF5V3R7RSXngyBn
1GLxVFHKR753Gt0IDag13Bd8Jt890/v0tE0Kx66jCkRGn+VCq6+bsnh7VpTH/cG5
dlFnv56lv2leknu5ghdJHX8YQ6HjnioaaheLA+ORAxqAlD8Itt1/pRBOOMSkutdz
d1px9dB2ZBpSoRAOcBwU5aFaw9uu+tXyzrPM3tZomu8ryQYMNlmVgPNDJOz6jPJi
jaZHWTS7U6j370oH/B0KTUG/ybrJGFnOmPP4h2u/ugG75EkfotURsvbrWuetQhOi
TCH+9nbIcT3pxnTXqI2IRHZXMturQ+6fqlJF3bb9bWarMBuC3KgprqyqXxeM0Sqg
VlyKLWwAuMf2Ec7t7ujqaNmVgv6bpwHEbR6njIi7lC7j4w6D2YQ8vacgvS3MB/K0
SX54HNVBVuXhAixPtYJ6tOBGm7QFAKaXju0PJ+AljnMEsHRekOs2u42OHBXEWDE8
VHw7/lTXWsJkBcQM+g/svyqV4xKHDAixPms2SUwJyKjvEgV+CQok4F/T
-----END ENCRYPTED PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIC9TCCAl6gAwIBAgIJANL8E4epRNznMA0GCSqGSIb3DQEBBQUAMFsxGDAWBgNV
BAoTD1N1cGVyZmlzaCwgSW5jLjELMAkGA1UEBxMCU0YxCzAJBgNVBAgTAkNBMQsw
CQYDVQQGEwJVUzEYMBYGA1UEAxMPU3VwZXJmaXNoLCBJbmMuMB4XDTE0MDUxMjE2
MjUyNloXDTM0MDUwNzE2MjUyNlowWzEYMBYGA1UEChMPU3VwZXJmaXNoLCBJbmMu
MQswCQYDVQQHEwJTRjELMAkGA1UECBMCQ0ExCzAJBgNVBAYTAlVTMRgwFgYDVQQD
Ew9TdXBlcmZpc2gsIEluYy4wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAOjz
Shh2Xxk/sc9Y6X9DBwmVgDXFD/5xMSeBmRImIKXfj2r8QlU57gk4idngNsSsAYJb
1Tnm+Y8HiN/+7vahFM6pdEXY/fAXVyqC4XouEpNarIrXFWPRt5tVgA9YvBxJ7SBi
3bZMpTrrHD2g/3pxptMQeDOuS8Ic/ZJKocPnQaQtAgMBAAGjgcAwgb0wDAYDVR0T
BAUwAwEB/zAdBgNVHQ4EFgQU+5izU38URC7o7tUJml4OVoaoNYgwgY0GA1UdIwSB
hTCBgoAU+5izU38URC7o7tUJml4OVoaoNYihX6RdMFsxGDAWBgNVBAoTD1N1cGVy
ZmlzaCwgSW5jLjELMAkGA1UEBxMCU0YxCzAJBgNVBAgTAkNBMQswCQYDVQQGEwJV
UzEYMBYGA1UEAxMPU3VwZXJmaXNoLCBJbmMuggkA0vwTh6lE3OcwDQYJKoZIhvcN
AQEFBQADgYEApHyg7ApKx3DEcWjzOyLi3JyN0JL+c35yK1VEmxu0Qusfr76645Oj
1IsYwpTws6a9ZTRMzST4GQvFFQra81eLqYbPbMPuhC+FCxkUF5i0DNSWi+kczJXJ
TtCqSwGl9t9JEoFqvtW+znZ9TqyLiOMw7TGEUI+88VAqW0qmXnwPcfo=
-----END CERTIFICATE-----
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You may be noticing that the obfuscated version can be significantly longer than the original data.  This is an unfortunate side effect, but it can be helped in some cases using compression before the data is obfuscated.  The compression method used doesn&amp;rsquo;t really matter, as long as it is the same on both sides.  Additionally, if the transport method being used supports compression, ASCII text tends to compress quite well.&lt;/p&gt;

&lt;h2 id=&#34;use-cases:84e7421e24ba41f3bed9835a932084c9&#34;&gt;Use Cases&lt;/h2&gt;

&lt;p&gt;There are quite a few use cases for this that come to mind.  The first is the method it was developed to prove, exfiltrating data past a firewall.  Considering that the obfuscated data is text, it could even be sent out in emails without triggering an alert based on content, written to a Google Drive document, or simply POSTed via HTTP.  Similarly, it could be a simple command and control channel, as it would be very simple to POST data to an HTTP/IRC/etc server and receive a response.&lt;/p&gt;

&lt;p&gt;This could potentially be used to obfuscate other communication channels as well.  For instance, a method like this could be a positive addition to instant messaging plugin such as OTR, as it could hide the fact that there were encrypted communications.  Due to recent world events, and not wishing to support radical movements even indirectly, I won&amp;rsquo;t be releasing such plugin or improvement, and hoping that they suck even worse at coding than they do at hacking.&lt;/p&gt;

&lt;h2 id=&#34;detection:84e7421e24ba41f3bed9835a932084c9&#34;&gt;Detection&lt;/h2&gt;

&lt;p&gt;Detecting this method could be considerably difficult.  Much like most other issues on the blue team side of things, the greatest issue is related to detecting something at scale.  From a network firewall perspective, there would need to be parsing of all text, which would then need to be statistically analyzed and compared to Markov language models to see if the data strongly fit.  To be absolutely honest, it would require someone with considerably more skill than myself in machine learning (like any one of the actual data scientists at Cylance) in order to handle this kind of detection at scale without a significant number of false positives and false negatives. I do wish I had a better answer to detect this method, but right now, I do not.&lt;/p&gt;

&lt;h2 id=&#34;code:84e7421e24ba41f3bed9835a932084c9&#34;&gt;Code&lt;/h2&gt;

&lt;p&gt;The most up to date code for this project can be found in the following Gist:
&lt;a href=&#34;https://gist.github.com/bwall/125b29b8412332fc7203&#34;&gt;https://gist.github.com/bwall/125b29b8412332fc7203&lt;/a&gt;&lt;/p&gt;

&lt;script src=&#34;https://gist.github.com/bwall/125b29b8412332fc7203.js&#34;&gt;&lt;/script&gt;

&lt;h2 id=&#34;conclusion:84e7421e24ba41f3bed9835a932084c9&#34;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Even simple machine learning can blow conventional opposition out of the water.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://bwall.github.io/images/mindblown.gif&#34; alt=&#34;Mind-fucking-blown&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;addendum:84e7421e24ba41f3bed9835a932084c9&#34;&gt;Addendum&lt;/h2&gt;

&lt;p&gt;Per request of &lt;a href=&#34;https://twitter.com/RKornmeyer&#34;&gt;@RKornmeyer&lt;/a&gt;, I trained a Markov model based off of Taylor Swift lyrics.  Here are the results:&lt;/p&gt;

&lt;script src=&#34;https://gist.github.com/bwall/12823e39e4811dbaf872.js&#34;&gt;&lt;/script&gt;
</description>
    </item>
    
    <item>
      <title>Detecting shellcode over the network with scapy and libemu</title>
      <link>https://bwall.github.io/libemu-scapy-for-shellcode-on-the-network/</link>
      <pubDate>Sun, 11 Oct 2015 15:41:07 -0700</pubDate>
      
      <guid>https://bwall.github.io/libemu-scapy-for-shellcode-on-the-network/</guid>
      <description>

&lt;p&gt;In this blog post, I will describe a method of using libemu along with scapy in order to detect shellcode being sent across the network in unencrypted channels.  This method would not be particularly reasonable for large networks without a significant amount of computing power.  On the other hand, for semi-automated analysis, or even integration into something like Cuckoo Sandbox, it may be quite useful.&lt;/p&gt;

&lt;p&gt;While this proof of concept is currently functional, it would take some work on the project&amp;rsquo;s dependencies in order for me to consider the project a success.  I have not yet decided if I plan on dedicating significant time to resolving issues in the related projects.&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h1 id=&#34;network-detection-of-shellcode:f0f2ac46c551efb82181805b8d37429b&#34;&gt;Network Detection of Shellcode&lt;/h1&gt;

&lt;p&gt;In order to detect this shellcode, we need a few major components.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Method to detect shellcode in a buffer&lt;/li&gt;
&lt;li&gt;Method to acquire network packets&lt;/li&gt;
&lt;li&gt;Method to assembly socket communication over the network&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For the first requirement, we simply use libemu.&lt;/p&gt;

&lt;p&gt;For the remaining requirements, we use scapy and some additional Python code.&lt;/p&gt;

&lt;h2 id=&#34;libemu:f0f2ac46c551efb82181805b8d37429b&#34;&gt;libemu&lt;/h2&gt;

&lt;p&gt;Libemu is a library for detecting and emulating shellcode, allowing for some automated analysis of shellcode.  Unfortunately, it does not appear to be under active development, and getting up to date source code is currently alluding me. It also appears to have a few bugs, some of which make it less viable for integration into network perimeter defenses.&lt;/p&gt;

&lt;p&gt;Along with it being difficult to locate the source, the current libemu interfaces to libemu in Python both seem to have some issues.  While both python-libemu and pylibemu are very useful, python-libemu fails to implement many of the features of libemu, and pylibemu currently has some issues which seriously impact memory usage.&lt;/p&gt;

&lt;p&gt;I have found that even via the Python interfaces, an arbitrary buffer supplied to libemu for processing can lead to a floating point error, which will crash the process.  This is one reason I do not suggest running this in production environments, or on large enterprise networks.&lt;/p&gt;

&lt;p&gt;For our purposes, we&amp;rsquo;ll use python-libemu, installed on Ubuntu with the following:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo apt-get install python-libemu
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;scapy:f0f2ac46c551efb82181805b8d37429b&#34;&gt;scapy&lt;/h2&gt;

&lt;p&gt;Scapy is well known as a raw networking library for Python, and being pretty awesome.  I&amp;rsquo;m not going to spend time covering Scapy.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo pip install scapy
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;analysis:f0f2ac46c551efb82181805b8d37429b&#34;&gt;Analysis&lt;/h2&gt;

&lt;p&gt;In order to scan over these packets in a similar way that the attacker would send them, we need to create the socket streams.  More specifically, we need to look at each direction of communication.  Additionally, we don&amp;rsquo;t want all of every stream in memory at the same time, so we use a LRUCache (from cachetools) to keep the most recent streams in memory, and use a memory buffering technique called a sliding window.&lt;/p&gt;

&lt;p&gt;In a sliding window, we set the max amount of memory we want to use per stream, then as we get new data, we append the new data, then cut off bytes in the beginning of our buffer until it is smaller than our max buffer size.  This way we can look at all the data, and avoid simply looking at each packet.&lt;/p&gt;

&lt;p&gt;For each new packet we get, we scan the sliding window buffer with libemu.  If libemu detects shellcode, we print the offset and the quad (ip:port-ip:port).&lt;/p&gt;

&lt;h1 id=&#34;code:f0f2ac46c551efb82181805b8d37429b&#34;&gt;Code&lt;/h1&gt;

&lt;p&gt;I will not update the code in this blog post, but if I need to, I will update the code in the following gist.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://gist.github.com/bwall/9cba618eacedc68c656b&#34;&gt;Network Shellcode Detection Proof of Concept&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the proof of concept, the shellcode detection is being done across every thread on the local computer.  This is done because libemu scanning scan be quite CPU intensive and slow.&lt;/p&gt;

&lt;p&gt;The PoC requires the following commands before being installed.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo apt-get install python-libemu python-pip
sudo pip install scapy
sudo pip install cachetools
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The code:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#!/usr/bin/env python2
import logging

logging.getLogger(&amp;quot;scapy.runtime&amp;quot;).setLevel(logging.ERROR)
from multiprocessing.pool import ThreadPool
from multiprocessing import cpu_count
import libemu
from cachetools import LRUCache
from scapy.layers.all import TCP, UDP, Raw
from scapy.all import sniff
import Queue


stream_cache = LRUCache(1024)
BUFFER_SIZE = 1024 * 1024
USE_SLIDING_WINDOW = True
THREADS = cpu_count()
thread_pool = None


class LimitedPool(ThreadPool):
    def __init__(self, processes=None, initializer=None, initargs=(), max_queue_size=10000):
        self._max_queue_size = max_queue_size
        ThreadPool.__init__(self, processes, initializer, initargs)

    def _setup_queues(self):
        self._inqueue = Queue.Queue(self._max_queue_size)
        self._outqueue = Queue.Queue()
        self._quick_put = self._inqueue.put
        self._quick_get = self._outqueue.get


def generate_key(packet):
    k = &amp;quot;{0}:{1}-{2}:{3}&amp;quot;.format(packet.payload.src, packet.payload.payload.sport, packet.payload.dst, packet.payload.payload.dport)
    if packet.haslayer(TCP):
        return &amp;quot;tcp://{0}&amp;quot;.format(k)
    if packet.haslayer(UDP):
        return &amp;quot;udp://{0}&amp;quot;.format(k)


def test_for_shellcode((key, packet, file_path)):
    e = libemu.Emulator()
    r = e.test(packet)
    if r is not None and r &amp;gt;= 0:
        logging.warning(&amp;quot;{2}: {0} - {1}&amp;quot;.format(key, {&amp;quot;offset&amp;quot;: r}, file_path))


def process_packet(pkt, file_path):
    global thread_pool
    try:
        if pkt.haslayer(Raw) and len(pkt[Raw].original) &amp;gt; 0:
            k = generate_key(pkt)
            if USE_SLIDING_WINDOW:
                if k in stream_cache:
                    stream_cache[k] += pkt[Raw].original
                    stream_cache[k] = stream_cache[k][-BUFFER_SIZE:]
                else:
                    stream_cache[k] = pkt[Raw].original[-BUFFER_SIZE:]
                p = stream_cache[k]
            else:
                p = pkt[Raw].original

            #test_for_shellcode((k, p, file_path))
            thread_pool.apply_async(test_for_shellcode, [(k, p, file_path)])
    except KeyboardInterrupt:
        raise
    except:
        pass


if __name__ == &amp;quot;__main__&amp;quot;:
    logging.basicConfig(level=logging.DEBUG)
    from argparse import ArgumentParser

    parser = ArgumentParser(
        prog=__file__,
        description=&amp;quot;Proof of concept for shellcode identification in pcap or network&amp;quot;,
        version=&amp;quot;%(prog)s v0.0.1 by Brian Wallace (@botnet_hunter)&amp;quot;,
        epilog=&amp;quot;%(prog)s v0.0.1 by Brian Wallace (@botnet_hunter)&amp;quot;
    )
    parser.add_argument(&#39;path&#39;, metavar=&#39;path&#39;, type=str, nargs=&#39;*&#39;, default=None, help=&amp;quot;Paths to files to parse&amp;quot;)

    args = parser.parse_args()

    thread_pool = LimitedPool(processes=THREADS, max_queue_size=200)

    if args.path is None or len(args.path) == 0:
        print &amp;quot;Live sniffing&amp;quot;
        sniff(store=0, filter=&amp;quot;tcp or udp&amp;quot;, prn=lambda x: process_packet(x, &amp;quot;live&amp;quot;))
    else:
        for p in args.path:
            logging.warning(&amp;quot;Reading packets from {0}&amp;quot;.format(p))
            sniff(store=0, filter=&amp;quot;tcp or udp&amp;quot;, offline=p, prn=lambda x: process_packet(x, p))

    thread_pool.close()
    thread_pool.join()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;http://i.imgur.com/xMKiC7W.png&#34; alt=&#34;Network shellcode detection PoC working&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Using bamfdetect in your own workflow</title>
      <link>https://bwall.github.io/bamfdetect/</link>
      <pubDate>Sun, 04 Oct 2015 17:59:07 -0700</pubDate>
      
      <guid>https://bwall.github.io/bamfdetect/</guid>
      <description>

&lt;p&gt;When hunting botnets, whether they are custom developed or widely available, it can be helpful to statically extract configurations.  With this ability, an automated workflow can be developed to identify and track botnets at scale.  For this reason, I have developed &lt;a href=&#34;https://github.com/bwall/bamfdetect&#34;&gt;bamfdetect&lt;/a&gt;.&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h1 id=&#34;bamfdetect:edf56eff04a8abdbcf184973e6c4191b&#34;&gt;bamfdetect&lt;/h1&gt;

&lt;p&gt;bamfdetect is a tool which is designed to identify malware samples and statically extract their configuration information, such as the domain name of the command and control server.  It is capable of taking in a single file path, or a variety of file paths.  It supports searching inside of directories, archives, etc. Once it identifies files to process, it starts processing through groups of modules.  The modules are as follows.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Preprocessors&lt;/li&gt;
&lt;li&gt;Bot Modules&lt;/li&gt;
&lt;li&gt;Postprocessors&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;preprocessors:edf56eff04a8abdbcf184973e6c4191b&#34;&gt;Preprocessors&lt;/h2&gt;

&lt;p&gt;Preprocessors have the ability to modify the file before being processed by the bot modules.  This can be useful if files are somehow packed or obfuscated.  The only currently (at the time of this blog being written) implemented preprocessor is the UPX decompressor.  This identifies if the input file is UPX compressed, then uses the UPX binary installed on the system to decompress it.  This functionality may be removed in the near future.&lt;/p&gt;

&lt;p&gt;A planned preprocessor module is a reimplementation of the PHP decoder I have running &lt;a href=&#34;https://defense.ballastsecurity.net/decoding/index.php&#34;&gt;here&lt;/a&gt;.  This would deobfuscate PHP files being processed.&lt;/p&gt;

&lt;h2 id=&#34;bot-modules:edf56eff04a8abdbcf184973e6c4191b&#34;&gt;Bot Modules&lt;/h2&gt;

&lt;p&gt;Bot modules are the heart of bamfdetect.  These modules are implemented in two portions, the identifier and the extractor.  The identifiers, all of which are currently Yara signatures, identify whether a file being analyzed is a bot supported by the bot module.  Since bot modules tend to focus on a single bot type or a family of very similar bots, this generally confirms that the module is likely capable of extracting the configuration.&lt;/p&gt;

&lt;p&gt;The configuration extraction is then done with Python code.  Configuration extraction can be very strict or very loose, depending on how reliably the configuration is stored in the malware.  Admitedly, in some cases, the configuration extraction methods have been implemented somewhat lazily, so false positives and improperly extracted configurations are possible.&lt;/p&gt;

&lt;h2 id=&#34;postprocessors:edf56eff04a8abdbcf184973e6c4191b&#34;&gt;Postprocessors&lt;/h2&gt;

&lt;p&gt;The purpose of postprocessor modules are to run after a file has been identified by at least one module.  The postprocessor modules also have access to the extracted configuration information, so they can be acted upon.  The only currently included postprocessing module calculates hashes on the file that was processed.  I do have a few private postprocessing modules which I will mention shortly.&lt;/p&gt;

&lt;h1 id=&#34;workflow:edf56eff04a8abdbcf184973e6c4191b&#34;&gt;Workflow&lt;/h1&gt;

&lt;p&gt;bamfdetect is a wonderful component of my malware tracking workflow.  Clearly, I&amp;rsquo;m not about to give away all my secrets right now, but here is a sample workflow which can be done with bamfdetect.&lt;/p&gt;


&lt;figure &gt;
    
        &lt;img src=&#34;https://bwall.github.io/images/bamfworkflow.png&#34; /&gt;
    
    
    &lt;figcaption&gt;
        &lt;h4&gt;Bot tracking workflow&lt;/h4&gt;
        
    &lt;/figcaption&gt;
    
&lt;/figure&gt;


&lt;p&gt;Since bamfdetect has Yara signatures defined inside of it, these Yara signatures can be used in services such as VirusTotal Hunting in order to hunt for relevant samples.  One can very simply download all files that trigger VirusTotal Hunting, and then feed them into bamfdetect.  Files can also be fed in through a variety of other sources.&lt;/p&gt;

&lt;p&gt;In order to make use of this, we can create a postprocessing module for bamfdetect which will upload any command and control information to our botnet tracking system.  Since very few people utilize publicly available systems for this, the code below is very generic.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from BAMF_Detect.postprocessors.common import Postprocessor, Postprocessors
import httplib
import urllib
import json


def submit_c2(c2_uri, bot_type, source, api_key):
    try:
        params = urllib.urlencode({&#39;api_key&#39;: api_key, &#39;uri&#39;: c2_uri, &#39;bot_type&#39;: bot_type, &#39;source&#39;: source})
        headers = {&amp;quot;Content-type&amp;quot;: &amp;quot;application/x-www-form-urlencoded&amp;quot;, &amp;quot;Accept&amp;quot;: &amp;quot;text/plain&amp;quot;}
        conn = httplib.HTTPSConnection(&amp;quot;c2_tracking.example.com&amp;quot;)
        conn.request(&amp;quot;POST&amp;quot;, &amp;quot;/upload_c2&amp;quot;, params, headers)
        response = conn.getresponse()
        data = response.read()
        conn.close()
        return json.loads(data)
    except KeyboardInterrupt:
        raise
    except:
        pass


class SubmitPanel(Postprocessor):
    def __init__(self):
        Postprocessor.__init__(
            self,
            name=&amp;quot;Hashes&amp;quot;,
            author=&amp;quot;Brian Wallace (@botnet_hunter)&amp;quot;,
            date=&amp;quot;March 14th, 2015&amp;quot;,
            description=&amp;quot;Submits panel to C2 database&amp;quot;,
            references=&amp;quot;&amp;quot;,
            version=&amp;quot;1.0.0.0&amp;quot;
        )

    def _do_processing(self, file_data, config):
        if &amp;quot;information&amp;quot; in config:
            configuration = config[&amp;quot;information&amp;quot;]
            bot_type = config[&amp;quot;type&amp;quot;].lower()

            if &amp;quot;c2_uri&amp;quot; in configuration:
                # Simple bot setup
                submit_c2(configuration[&amp;quot;c2_uri&amp;quot;], bot_type, &amp;quot;bamfdetect&amp;quot;, &amp;quot;api-key&amp;quot;)
            elif &amp;quot;c2s&amp;quot; in configuration:
                for c in configuration[&amp;quot;c2s&amp;quot;]:
                    if &amp;quot;c2_uri&amp;quot; in c:
                        submit_c2(c[&amp;quot;c2_uri&amp;quot;], bot_type, &amp;quot;bamfdetect&amp;quot;, &amp;quot;api-key&amp;quot;)

        return {}, file_data

Postprocessors.add_postprocessor(SubmitPanel())
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This way, anytime we scan a file, the command and control information will be uploaded to c2_tracking.example.com to be automatically tracked.  This is one of the methods I use to feed my botnet tracking platform.&lt;/p&gt;

&lt;p&gt;
&lt;figure &gt;
    
        &lt;img src=&#34;https://bwall.github.io/images/tracking.png&#34; /&gt;
    
    
    &lt;figcaption&gt;
        &lt;h4&gt;Bot tracking panel&lt;/h4&gt;
        
    &lt;/figcaption&gt;
    
&lt;/figure&gt;

&lt;a href=&#34;https://gist.github.com/bwall/aa3bf86bd2f2396d6ef5&#34;&gt;Tracking panel source&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Extract Hosts</title>
      <link>https://bwall.github.io/extract-hosts/</link>
      <pubDate>Fri, 18 Apr 2014 10:19:07 -0700</pubDate>
      
      <guid>https://bwall.github.io/extract-hosts/</guid>
      <description>

&lt;p&gt;Recently, I have been trying to focus more on creating small but useful utilities.  The first of these tools to be posted publicly is &lt;a href=&#34;https://github.com/bwall/ExtractHosts&#34;&gt;Extract Hosts&lt;/a&gt;.  The purpose of this utility is to search for domain names and IP addresses in the supplied input.  The following is information posted to the readme on the project page.  You can download the 1.1.0 release of Extract Hosts &lt;a href=&#34;https://github.com/bwall/ExtractHosts/archive/v1.1.0.zip&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h1 id=&#34;extracthosts:8154605aecfea6ca754b3151f752e9f0&#34;&gt;ExtractHosts&lt;/h1&gt;

&lt;p&gt;Extracts hosts (IP/Hostnames) from files.  Hosts can be extracted from text files, PE, etc.  Any file that keeps the
host in plaintext without obscuring it, this should extract it.&lt;/p&gt;

&lt;p&gt;The name came about when polling random people on the street about the idea, and they responded, &amp;ldquo;eh?&amp;rdquo;.  With this installed,
all you need to type is &amp;lsquo;eh&amp;rsquo; to start pulling hosts from input.&lt;/p&gt;

&lt;h1 id=&#34;installation:8154605aecfea6ca754b3151f752e9f0&#34;&gt;Installation&lt;/h1&gt;

&lt;pre&gt;&lt;code&gt;git clone https://github.com/bwall/ExtractHosts.git
cd ExtractHosts
sudo python setup.py install
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;examples:8154605aecfea6ca754b3151f752e9f0&#34;&gt;Examples&lt;/h1&gt;

&lt;p&gt;The following are just some example usages&lt;/p&gt;

&lt;h2 id=&#34;help:8154605aecfea6ca754b3151f752e9f0&#34;&gt;help&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;bwall@research:~$ eh -h
usage: /usr/local/bin/eh [-h] [-v] [-r] [-f] [-d] [-T] [path [path ...]]

Identifies and extracts domains and IPs from files

positional arguments:
  path                  Paths to files or directories to scan (if not
                        supplied, stdin is the file being read)

optional arguments:
  -h, --help            show this help message and exit
  -v, --version         show program&#39;s version number and exit
  -r, --recursive       Scan paths recursively
  -f, --show-files      Show file names along with results
  -d, --hide-duplicates
                        Hide duplicate results (hides per file when show-files
                        is enabled)
  -s, --strict          Stricter processing of domains
  -T, --test            Run some quick self tests

/usr/local/bin/eh v1.1.0 by Brian Wallace (@botnet_hunter)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;wget:8154605aecfea6ca754b3151f752e9f0&#34;&gt;wget&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;bwall@research:~$ wget http://bwall.github.io/ -qO- | eh -d
bwall.github.io
twitter.com
gmail.com
github.com
README.md
ajax.googleapis.com
crypto-js.googlecode.com
google-analytics.com
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;malware:8154605aecfea6ca754b3151f752e9f0&#34;&gt;malware&lt;/h2&gt;

&lt;p&gt;The 0686429b86844d9d1a14a159a0263b9bfcea4fd247c77537aa0278c9c5cb4ac3 file is a sample of the POS malware, Dexter, created for demo purposes.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;bwall@research:~$ eh 0686429b86844d9d1a14a159a0263b9bfcea4fd247c77537aa0278c9c5cb4ac3
houseofcarders.com
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;file-system-recursion:8154605aecfea6ca754b3151f752e9f0&#34;&gt;File system recursion&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;bwall@research:~$ eh -drf Downloads/PEStudio/
/home/bwall/Downloads/PEStudio/PeStudioFunctionsDeprecated.xml  www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioFunctionsDeprecated.xml  msdn.microsoft.com
/home/bwall/Downloads/PEStudio/PeStudioBlackListFunctions.xml   www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioEvasions.xml www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioIndicators.xml   www.winitor.com
/home/bwall/Downloads/PEStudio/ChangeLog.txt    winitor.com
/home/bwall/Downloads/PEStudio/ChangeLog.txt    www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioThresholds.xml   www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioWhiteListSections.xml    www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioBlackListLibraries.xml   www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioOrdinals.xml www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioVirusTotal.xml   www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioCodePages.xml    www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioCodePages.xml    msdn.microsoft.com
/home/bwall/Downloads/PEStudio/PeStudioWhiteListLibraries.xml   www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioFeatures.xml www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudio.exe 6.0.0.0
/home/bwall/Downloads/PEStudio/PeStudioSettings.xml www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml internetmailru.cdnmail.ru
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml sputnik.mail.ru
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml mail.ru
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml Command.com
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml 127.0.0.1
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml 2.0.0.1
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml www.memtest86.com
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml boxedapp.com
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml PAYPAL.COM
/home/bwall/Downloads/PEStudio/PeStudioBlackListStrings.xml start.spoon.net
/home/bwall/Downloads/PEStudio/PeStudioFunctionsUndocumented.xml    www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioWellKnownResources.xml   www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioFunctionsMapping.xml www.winitor.com
/home/bwall/Downloads/PEStudio/PeParser.dll 776::06
/home/bwall/Downloads/PEStudio/PeParser.dll ::
/home/bwall/Downloads/PEStudio/PeParser.dll 3::
/home/bwall/Downloads/PEStudio/PeStudioTranslations.xml www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioBlackListLanguages.xml   www.winitor.com
/home/bwall/Downloads/PEStudio/PeStudioBlackListLanguages.xml   msdn.microsoft.com
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;change-log:8154605aecfea6ca754b3151f752e9f0&#34;&gt;Change log&lt;/h1&gt;

&lt;h2 id=&#34;version-1-1-0:8154605aecfea6ca754b3151f752e9f0&#34;&gt;Version 1.1.0&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Files are no longer loaded completely into RAM so larger files can be processed (performance increase noticed)&lt;/li&gt;
&lt;li&gt;Strict mode added, where domains are only considered if all lower case&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;todo:8154605aecfea6ca754b3151f752e9f0&#34;&gt;TODO&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;IPv6 regex needs to be shorted and heavily tested&lt;/li&gt;
&lt;li&gt;Heavier testing&lt;/li&gt;
&lt;li&gt;Improve performance&lt;/li&gt;
&lt;li&gt;Multiple core processing support&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>